# lspci

| 选项                        | 功能                                                         |
| --------------------------- | ------------------------------------------------------------ |
| -v                          | 显示PCIe设备的简略信息                                       |
| -vv                         | 显示PCIe设备的详细信息                                       |
| -vvv                        | 显示PCIe设备所有可解析的信息                                 |
| -s [[<bus>]:]\[<slot>][.[<func>]] | 仅显示指定总线、插槽上的设备或设备上的功能块信息。设备地址的任何部分都可以忽略，或以「*」代替 (意味着所有值)。所有数字都是十六进制。例如：「0：」指的是在0号总线上的所有设备；「0」指的是在任意总线上0号设备的所有功能块；「0.3」选择 了所有总线上0号设备的第三个功能块；「.4」则是只列出每一设备上的第四个功能块。 |
| -n                          | 以数字形式显示 PCI 生产厂商和设备号，而不是在 PCI ID 数据库中查找它们。 |
| -nn | 同时显示数字ID和设备名称 |
| -d [<vendor>]:[<device>]    | 只显示指定生产厂商和设备 ID 的设备。 这两个 ID 都以十六进制表示，可以忽略或者以「*」代替 (意味著所有值)。 |
| -x                          | 以16进制显示配置空间的前64字节                               |
| -xx                         | 以16进制显示配置空间的前256字节                              |
| -xxx                        | 以十六进制显示所有 PCI 配置空间的映像。此选项只有 root 可用，并且很多 PCI 设备在你试图读取配置空间的未定义部分时会崩溃 (此操作可能不违反PCI标准，但是它至少非常愚蠢)。 |
| -b | 以总线为中心视图（Bus-centric view）。显示 PCI 总线上的卡所见的所有 IRQ 编号和地址，而不是内核所见的。 |
| -t | 以树形方式显示包含所有总线、桥、设备和它们的连接的图表。 |
| -tv | 树形结构显示设备上所有pcie设备，并显示简要信息 |
| -s [[<bus>]:]\[<slot>][.[<func>]] | 仅显示指定总线、插槽上的设备或设备上的功能块信息。设备地址的任何部分都可以忽略，或以「*」代替 (意味著所有值)。所有数字都是十六进制。例如：「0：」指的是在0号总线上的所有设备；「0」指的是在任意总线上0号设备的所有功能块；「0.3」选择 了所有总线上0号设备的第三个功能块；「.4」则是只列出每一设备上的第四个功能块。 |
| -i <file> | 使用 <file> 作为 PCI ID 数据库而不是使用预设的 /usr/share/hwdata/pci.ids或者/usr/share/misc/pci.ids。 |
| -m | 以机器可读的方式转储 PCI 设备数据 (支持两种模式：普通和冗余)，便於稿本解析。 |
| -M | 使用总线映射模式，这种模式对总线进行全面地扫描以查明总线上的所有设备，包括配置错误的桥之后的设备。请注意，此操作只应在调试时使 用，并可能造成系统崩溃 (只在设备有错误的时候，但是不幸的是它们存在)，此命令只有 root 可以使用。同时，在不直接接触硬体的 PCI 访问模式中使用 -M 参数没有意义，因为显示的结果 (排除 lspci 中的 bug 的影响) 与普通的列表模式相同。 |
| --version | 显示 lspci 的版本。这个选项应当单独使用。 |

### 常见用法

```bash
lspci -vv  
lspci -n
lspci -tv                --树形结构显示设备上所有pcie设备，并显示简要信息
lspci -tn                --树形结构显示设备上所有pcie设备，并deviceid vendorid
lspci -vv -s 00:1f.3     --查看00:1f.3设备的详细信息
lspci -xxx -s 00:1f.3    --查看00:1f.3设备配置空间的所有内容
lspci -vv -d 8086:8c22   --查看8086:8c22设备的的详细信息
lspci -xxx -d 8086:8c22   --查看8086:8c22设备配置空间的所有内容
lspci -vvvxxx -s 01:00.0 --查看01:00.0设备配置空间的所有内容及寄存器值
lspci -xxxx -s 01:00.0	--查看01:00.0设备配置空间寄存器值
```

## 查看Linux下的PCIe设备

### 查看所有设备

```bash
lspci
```

显示的信息中，`+`表示1（Enable）`-`表示0（Disable）

### 查看特定设备详细信息

```bash
lspci -s <bdf number> -vvv
```

### 查看配置空间

```bash
lspci -s <bdf number> -xxx
```

### 查看详细格式

```bash
lspci -vmm
```

## 常见问题

### 设备识别问题

如果某些设备无法识别，可以尝试更新 PCI ID 数据库：

```bash
sudo update-pciids
```

# 参考

[lspci linux 命令 在线中文手册](http://linux.51yip.com/search/lspci)
